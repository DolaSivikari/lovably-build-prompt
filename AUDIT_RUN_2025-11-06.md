# Full Audit Run — 2025-11-06 (America/Toronto)

## Summary of Stages

| Stage                              | Status     | Notes                                                                                                                          |
| ---------------------------------- | ---------- | ------------------------------------------------------------------------------------------------------------------------------ |
| TypeScript type check              | ✅ Pass    | `npm run typecheck` completed without diagnostics.                                                                             |
| ESLint                             | ❌ Fail    | 645 errors, including restricted `@/components/ui/*` imports and numerous `any` usages (`@typescript-eslint/no-explicit-any`). |
| Prettier format check              | ❌ Fail    | Syntax error in `scripts/auto-fix-imports.js` (`Unterminated string constant` at line 153) and widespread formatting drift.    |
| Dead code scan (`ts-prune`)        | ⚠️ Blocked | `npx ts-prune` download denied (`403 Forbidden`).                                                                              |
| Circular dependency scan (`madge`) | ⚠️ Blocked | `npx madge` download denied (`403 Forbidden`).                                                                                 |
| Unit tests (`vitest`)              | ⚠️ Blocked | `npx vitest` download denied (`403 Forbidden`).                                                                                |
| Playwright E2E                     | ⚠️ Blocked | `npx playwright test` download denied (`403 Forbidden`).                                                                       |
| Accessibility suite                | ⚠️ Blocked | `npx playwright` download denied (`403 Forbidden`).                                                                            |
| Lighthouse CI                      | ❌ Fail    | Health check aborts: Chrome binary missing.                                                                                    |
| Bundle analysis                    | ⚠️ Blocked | `npx source-map-explorer` download denied (`403 Forbidden`).                                                                   |
| Secret scanning                    | ❌ Fail    | `gitleaks` and Docker CLI unavailable in runner.                                                                               |
| Vulnerability scan                 | ⚠️ Blocked | `osv-scanner` download denied and Docker unavailable.                                                                          |
| Route crawler                      | ❌ Fail    | `@playwright/test` missing; script requests manual install.                                                                    |

## Top Findings

1. Resolve restricted UI imports by switching to `/src/ui` primitives and eliminate `any` usages across admin/pages/utilities modules flagged by ESLint.
2. Repair `scripts/auto-fix-imports.js` (line 153) string literal and run Prettier to realign repository formatting.
3. Provision authenticated npm access (or vendored packages) so `ts-prune`, `madge`, `vitest`, `playwright`, `source-map-explorer`, and `osv-scanner` can install under CI.
4. Install Chrome (e.g., via `apt-get install chromium` or `npx playwright install chromium`) before invoking Lighthouse CI.
5. Provide the `gitleaks` binary (or enable Docker) for the secrets scan step.
6. Install Docker or adjust fallback logic for `osv-scanner` to avoid double failure when npm and Docker are unavailable.
7. Add `@playwright/test` to dev dependencies (and install browsers) so the route crawler can execute.
8. Review Vite build output — several chunks exceed 400 kB and image optimization fails because `sharp`/`svgo` are absent.
9. Supply admin credentials through environment variables before running authenticated routes in Lighthouse/Playwright.
10. Consider caching the `node_modules` directory between runs to avoid repeated network fetch failures in restricted environments.

## Artifacts

No HTML or JSON reports were generated because the dependent tooling could not complete. The `dist/` bundle from `npm run build` is available locally for manual inspection.

## Next Steps

- Triage and fix ESLint/Prettier violations, commit clean formatting, and rerun the audit.
- Coordinate with DevOps to grant npm access or prebundle required CLIs within the repository.
- Install required browsers and binaries (Chrome, Playwright, gitleaks, osv-scanner, sharp) on the CI image.
- Re-run `npm run audit:all` once the environment issues are resolved to capture the remaining reports.
